# ç»“æ„ä½“è§£ææ”¹è¿›æ€»ç»“

## å·²å®ç°çš„æ”¹è¿›

### 1. é«˜çº§ç»“æ„ä½“è§£æå™¨ (StructParser)

**æ–°å¢æ–‡ä»¶**: `src/frontend/views/struct-parser.ts`

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… æ”¯æŒåµŒå¥—ç»“æ„ä½“è§£æ
- âœ… æ”¯æŒè”åˆä½“æˆå‘˜è¯†åˆ«
- âœ… æ”¯æŒæ•°ç»„å…ƒç´ è§£æ
- âœ… è‡ªåŠ¨æ•°å€¼æå–å’Œå“ˆå¸Œè®¡ç®—
- âœ… å¤„ç†ç®€åŒ–çš„ç»“æ„ä½“è¡¨ç¤º (`{...}`)

**æ”¯æŒçš„æ ¼å¼**:
```c
// åŸºæœ¬ç»“æ„ä½“
{a = 10, b = 20.5}

// åµŒå¥—ç»“æ„ä½“
{outer = {inner = {value = 100}}, count = 5}

// è”åˆä½“
union_name { active_member = 42 }

// æ•°ç»„
{[0] = 1, [1] = 2, [2] = 3}

// æ··åˆç±»å‹
{num = 42, flags = 0xFF, ptr = 0x20000000}
```

### 2. ç»“æ„ä½“æˆå‘˜é€‰æ‹©ç•Œé¢

**æ–°å¢å‘½ä»¤**:
- `cortex-debug.liveWatch.selectStructMembers` - é€‰æ‹©ç»“æ„ä½“æˆå‘˜
- `cortex-debug.waveform.configureStructMembers` - é…ç½®ç»“æ„ä½“æˆå‘˜

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… è‡ªåŠ¨æ£€æµ‹å¤æ‚ç»“æ„ä½“
- âœ… äº¤äº’å¼æˆå‘˜é€‰æ‹©ç•Œé¢
- âœ… ç”Ÿæˆæˆå‘˜ç›‘æ§è¡¨è¾¾å¼
- âœ… æ”¯æŒåµŒå¥—æˆå‘˜è·¯å¾„

### 3. æ™ºèƒ½ç»“æ„ä½“å±•å¼€

**è§£å†³çš„é—®é¢˜**: Live Watchè¿”å›`{...}`ç®€åŒ–è¡¨ç¤º

**è§£å†³æ–¹æ¡ˆ**:
```typescript
private async expandStructure(node: any, expression: string): Promise<string | null> {
    // 1. æ£€æµ‹ç®€åŒ–è¡¨ç¤º {...}
    // 2. è¯·æ±‚å­å˜é‡è¯¦ç»†ä¿¡æ¯
    // 3. æ„å»ºå®Œæ•´ç»“æ„ä½“è¡¨ç¤º
    // 4. å›é€€åˆ°ç›´æ¥è¯„ä¼°
}
```

**å±•å¼€é€»è¾‘**:
1. æ£€æµ‹åˆ°`{...}`æ—¶è‡ªåŠ¨è§¦å‘å±•å¼€
2. ä½¿ç”¨`liveVariables`è¯·æ±‚è·å–å­æˆå‘˜
3. æ„å»ºå®Œæ•´ç»“æ„ä½“å­—ç¬¦ä¸²
4. å¤±è´¥æ—¶å›é€€åˆ°GDBç›´æ¥è¯„ä¼°

### 4. å¢å¼ºçš„è°ƒè¯•æ”¯æŒ

**è¯¦ç»†æ—¥å¿—è¾“å‡º**:
```
[Waveform] Parsing structure with advanced parser: myStruct
[StructParser] Parsing structure: myStruct, value: {...}
[StructParser] Detected simplified structure representation for myStruct
[Waveform] Detected simplified structure, attempting expansion
[Waveform] Expanding structure for: myStruct
[Waveform] Requesting children for expansion, varRef: 12345
[Waveform] Got 3 children for expansion
[Waveform] Built expanded structure: {a = 10, b = 20.5, c = 'x'}
```

## ä½¿ç”¨æµç¨‹

### 1. åŸºæœ¬ç»“æ„ä½“ç›‘æ§

1. åœ¨Live Watchä¸­å³é”®ç‚¹å‡»ç»“æ„ä½“å˜é‡
2. é€‰æ‹©"Add to Waveform"
3. ç³»ç»Ÿè‡ªåŠ¨è§£æç»“æ„ä½“å†…å®¹
4. æ˜¾ç¤ºåœ¨æ³¢å½¢å›¾ä¸­

### 2. æˆå‘˜é€‰æ‹©ç›‘æ§

1. æ·»åŠ ç»“æ„ä½“åˆ°æ³¢å½¢å›¾æ—¶æ£€æµ‹åˆ°å¤æ‚ç»“æ„
2. é€‰æ‹©"Select Members"
3. åœ¨å¿«é€Ÿé€‰æ‹©ç•Œé¢ä¸­é€‰æ‹©æˆå‘˜
4. ç”Ÿæˆç‹¬ç«‹çš„ç›‘æ§è¡¨è¾¾å¼

### 3. é…ç½®å’Œç®¡ç†

1. å³é”®ç‚¹å‡»å·²æ·»åŠ çš„ç»“æ„ä½“
2. é€‰æ‹©"Configure Structure Members"
3. æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯å’Œå½“å‰å€¼
4. è°ƒæ•´æˆå‘˜é€‰æ‹©

## æŠ€æœ¯å®ç°

### æ ¸å¿ƒç»„ä»¶

1. **StructParserç±»**: é«˜çº§ç»“æ„ä½“è§£æ
2. **WaveformDataProvider**: é›†æˆè§£æå™¨å’Œæ•°æ®ç®¡ç†
3. **Extension Commands**: ç”¨æˆ·ç•Œé¢å’Œäº¤äº’

### æ•°æ®æµç¨‹

```
Live Watch Variable â†’ Detect Structure Type â†’ Expand if Needed â†’ Parse Members â†’ Extract Values â†’ Waveform Display
```

### é”™è¯¯å¤„ç†

- ä¼˜é›…é™çº§åˆ°ç®€å•è§£æ
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
- å¤šç§å›é€€ç­–ç•¥

## å½“å‰çŠ¶æ€

### âœ… å·²å®Œæˆ
- åŸºç¡€ç»“æ„ä½“è§£æåŠŸèƒ½
- åµŒå¥—ç»“æ„ä½“æ”¯æŒ
- è”åˆä½“è¯†åˆ«
- æˆå‘˜é€‰æ‹©ç•Œé¢
- æ™ºèƒ½å±•å¼€åŠŸèƒ½
- è¯¦ç»†è°ƒè¯•æ—¥å¿—

### ğŸ”„ å¾…æ”¹è¿›
- æ›´å¤æ‚çš„åµŒå¥—ç»“æ„å¤„ç†
- æ€§èƒ½ä¼˜åŒ–
- æ›´å¤šæ•°æ®ç±»å‹æ”¯æŒ
- å¯è§†åŒ–æ”¹è¿›

## æµ‹è¯•å»ºè®®

### åŸºæœ¬æµ‹è¯•
```c
struct TestStruct {
    int a;
    float b;
    char c;
};

struct TestStruct myStruct = {10, 20.5f, 'x'};
```

### åµŒå¥—æµ‹è¯•
```c
struct Point {
    int x, y;
};

struct Nested {
    struct Point pt;
    int count;
};

struct Nested myNested = {{10, 20}, 5};
```

### è”åˆä½“æµ‹è¯•
```c
union Data {
    int i;
    float f;
    char bytes[4];
};

union Data myUnion = {.i = 42};
```

## è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
æ‰“å¼€VS Codeå¼€å‘è€…å·¥å…·æŸ¥çœ‹è¯¦ç»†çš„è§£æè¿‡ç¨‹æ—¥å¿—ã€‚

### æ‰‹åŠ¨å±•å¼€
å¦‚æœè‡ªåŠ¨å±•å¼€å¤±è´¥ï¼Œå¯ä»¥ï¼š
1. åœ¨Live Watchä¸­æ‰‹åŠ¨å±•å¼€ç»“æ„ä½“
2. å³é”®ç‚¹å‡»å…·ä½“æˆå‘˜æ·»åŠ åˆ°æ³¢å½¢å›¾

### æ£€æŸ¥å˜é‡å¼•ç”¨
ç¡®ä¿ç»“æ„ä½“æœ‰æœ‰æ•ˆçš„variablesReferenceä»¥æ”¯æŒå±•å¼€ã€‚

è¿™äº›æ”¹è¿›å¤§å¤§å¢å¼ºäº†Cortex-Debugå¤„ç†å¤æ‚C/C++ç»“æ„ä½“çš„èƒ½åŠ›ï¼Œä¸ºåµŒå…¥å¼å¼€å‘æä¾›äº†å¼ºå¤§çš„å®æ—¶ç›‘æ§åŠŸèƒ½ã€‚